package com.prime.launcher.teletextservice.fullpageteletext;

import com.prime.launcher.R;

/**
 * Handle some charsets defined in ETS 30706
 * - G0, with national variations
 * - G0, with diacritical marks
 * - G1, adjust to particular font
 * - G2
 */
public class FttxGXCharset {
    // see table 32 and table 36 in ETS 300706
    private static char sG0Charsets[][] = {
            /* 000, english */
            {0x00a3, 0x0024, 0x0040, 0x00ab, 0x00bd, 0x00bb, 0x005e, 0x0023,
                    0x002d, 0x00bc, 0x00a6, 0x00be, 0x00f7},
            /* 001, german */
            {0x0023, 0x0024, 0x00a7, 0x00c4, 0x00d6, 0x00dc, 0x005e, 0x005f,
                    0x00b0, 0x00e4, 0x00f6, 0x00fc, 0x00df},
            /* 010, swedish,finnish,hungarian */
            {0x0023, 0x00a4, 0x00c9, 0x00c4, 0x00d6, 0x00c5, 0x00dc, 0x005f,
                    0x00e9, 0x00e4, 0x00f6, 0x00e5, 0x00fc},
            /* 011,  italian */
            {0x00a3, 0x0024, 0x00e9, 0x00b0, 0x00e7, 0x00bb, 0x005e, 0x0023,
                    0x00f9, 0x00e0, 0x00f2, 0x00e8, 0x00ec},
            /* 100, french */
            {0x00e9, 0x00ef, 0x00e0, 0x00eb, 0x00ea, 0x00f9, 0x00ee, 0x0023,
                    0x00e8, 0x00e2, 0x00f4, 0x00fb, 0x00e7, 0, 0x00eb, 0, 0x00ef},
            /* 101, portuguese,spanish */
            {0x00e7, 0x0024, 0x00a1, 0x00e1, 0x00e9, 0x00ed, 0x00f3, 0x00fa,
                    0x00bf, 0x00fc, 0x00f1, 0x00e8, 0x00e0},
            /* 110, czech,slovak */
            {0x0023, 0x016f, 0x010d, 0x0165, 0x017e, 0x00fd, 0x00ed, 0x0159,
                    0x00e9, 0x00e1, 0x011b, 0x00fa, 0x0161},
            /* 111, rumanian */
            {0x0023, 0x00a4, 0x0162, 0x00c2, 0x015e, 0x0102, 0x00ce, 0x0131,
                    0x0163, 0x00e2, 0x015f, 0x0103, 0x00ee},
    };


    // diacritical map are built according to table 35 (section 15.6.1) and column 4 of table 37
    // (section 15.6.3)
    private static final char sDiacriticalUppercaseMap[][] = {
            //           À       Á       Â       Ã       Ā       Ă               Ä               Å                               Ą       Ă
            {0x0000, 0x00C0, 0x00C1, 0x00C2, 0x00C3, 0x0100, 0x0102, 0x0000, 0x00C4, 0x0000, 0x00C5, 0x0000, 0x0000, 0x0000, 0x0104, 0x0102},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   Ć       Ĉ                       Č       Ċ                               Ç                               Č
            {0x0000, 0x0000, 0x0106, 0x0108, 0x0000, 0x0000, 0x010C, 0x010A, 0x0000, 0x0000, 0x0000, 0x00C7, 0x0000, 0x0000, 0x0000, 0x010C},
            //                                                   Ď                                                                       Ď
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x010E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x010E},
            //           È       É       Ê               Ē       Ĕ       Ė       Ë                                               Ę       Ě
            {0x0000, 0x00C8, 0x00C9, 0x00CA, 0x0000, 0x0112, 0x0114, 0x0116, 0x00CB, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0118, 0x011A},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                           Ĝ                       Ğ       Ġ                               Ģ
            {0x0000, 0x0000, 0x0000, 0x011C, 0x0000, 0x0000, 0x011E, 0x0120, 0x0000, 0x0000, 0x0000, 0x0122, 0x0000, 0x0000, 0x0000, 0x0000},
            //                           Ĥ               Ħ
            {0x0000, 0x0000, 0x0000, 0x0124, 0x0000, 0x0126, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //           Ì       Í       Î       Ĩ       Ī       Ĭ       İ       Ï                                               Į       Ĭ
            {0x0000, 0x00CC, 0x00CD, 0x00CE, 0x0128, 0x012A, 0x012C, 0x0130, 0x00CF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x012E, 0x012C},
            //                           Ĵ
            {0x0000, 0x0000, 0x0000, 0x0134, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                                                                                           Ķ
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0136, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   Ĺ                                       Ŀ                               Ļ                               Ľ
            {0x0000, 0x0000, 0x0139, 0x0000, 0x0000, 0x0000, 0x0000, 0x013F, 0x0000, 0x0000, 0x0000, 0x013B, 0x0000, 0x0000, 0x0000, 0x013D},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   Ń               Ñ                                                       Ņ                               Ň
            {0x0000, 0x0000, 0x0143, 0x0000, 0x00D1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0145, 0x0000, 0x0000, 0x0000, 0x0147},
            //           Ò       Ó       Ô       Õ       Ō       Ŏ               Ö                                       Ő               Ŏ
            {0x0000, 0x00D2, 0x00D3, 0x00D4, 0x00D5, 0x014C, 0x014E, 0x0000, 0x00D6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0150, 0x0000, 0x014E},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   Ŕ                                                                       Ŗ                               Ř
            {0x0000, 0x0000, 0x0154, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0156, 0x0000, 0x0000, 0x0000, 0x0158},
            //                   Ś       Ŝ                                                               Ş                               Š
            {0x0000, 0x0000, 0x015A, 0x015C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x015E, 0x0000, 0x0000, 0x0000, 0x0160},
            //                                                                                           Ţ                               Ť
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0162, 0x0000, 0x0000, 0x0000, 0x0164},
            //           Ù       Ú       Û       Ũ       Ū       Ŭ               Ü               Ů                       Ű       Ų       Ŭ
            {0x0000, 0x00D9, 0x00DA, 0x00DB, 0x0168, 0x016A, 0x016C, 0x0000, 0x00DC, 0x0000, 0x016E, 0x0000, 0x0000, 0x0170, 0x0172, 0x016C},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                           Ŵ
            {0x0000, 0x0000, 0x0000, 0x0174, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   Ý       Ŷ                                       Ÿ
            {0x0000, 0x0000, 0x00DD, 0x0176, 0x0000, 0x0000, 0x0000, 0x0000, 0x0178, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   Ź                                       Ż                                                               Ž
            {0x0000, 0x0000, 0x0179, 0x0000, 0x0000, 0x0000, 0x0000, 0x017B, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x017D},
    };

    //a=97 .. z=122
    private static final char sDiacriticalLowerCaseMap[][] = {
            //           à       á       â       ã       ā       ă               ä               å                               ą       ă
            {0x0000, 0x00E0, 0x00E1, 0x00E2, 0x00E3, 0x0101, 0x0103, 0x0000, 0x00E4, 0x0000, 0x00E5, 0x0000, 0x0000, 0x0000, 0x0105, 0x0103},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   ć       ĉ                       č       ċ                               ç                               č
            {0x0000, 0x0000, 0x0107, 0x0109, 0x0000, 0x0000, 0x010D, 0x010B, 0x0000, 0x0000, 0x0000, 0x00E7, 0x0000, 0x0000, 0x0000, 0x010D},
            //                                                   ď                                                                       ď
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x010F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x010F},
            //           è       é       ê               ē       ĕ       ė       ë                                               ę       ě
            {0x0000, 0x00E8, 0x00E9, 0x00EA, 0x0000, 0x0113, 0x0115, 0x0117, 0x00EB, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0119, 0x011B},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                           ĝ                       ğ       ġ                               ģ
            {0x0000, 0x0000, 0x0000, 0x011D, 0x0000, 0x0000, 0x011F, 0x0121, 0x0000, 0x0000, 0x0000, 0x0123, 0x0000, 0x0000, 0x0000, 0x0000},
            //                           ĥ               ħ
            {0x0000, 0x0000, 0x0000, 0x0125, 0x0000, 0x0127, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //           ì       í       î       ĩ       ī       ĭ       ı       ï                                               į       ĭ
            {0x0000, 0x00EC, 0x00ED, 0x00EE, 0x0129, 0x012B, 0x012D, 0x0131, 0x00EF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x012F, 0x012D},
            //                           ĵ
            {0x0000, 0x0000, 0x0000, 0x0135, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                                                                                           ķ
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0137, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   ĺ                                       ŀ                               ļ                               ľ
            {0x0000, 0x0000, 0x013A, 0x0000, 0x0000, 0x0000, 0x0000, 0x0140, 0x0000, 0x0000, 0x0000, 0x013C, 0x0000, 0x0000, 0x0000, 0x013E},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   ń               ñ                                                       ņ                               ň
            {0x0000, 0x0000, 0x0144, 0x0000, 0x00F1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0146, 0x0000, 0x0000, 0x0000, 0x0148},
            //           ò       ó       ô       õ       ō       ŏ               ö                                       ő               ŏ
            {0x0000, 0x00F2, 0x00F3, 0x00F4, 0x00F5, 0x014D, 0x014F, 0x0000, 0x00F6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0151, 0x0000, 0x014F},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   ŕ                                                                       ŗ                               ř
            {0x0000, 0x0000, 0x0155, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0157, 0x0000, 0x0000, 0x0000, 0x0159},
            //                   ś       ŝ                                                               ş                               š
            {0x0000, 0x0000, 0x015B, 0x015D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x015F, 0x0000, 0x0000, 0x0000, 0x0161},
            //                                                                                           ţ                               ť
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0163, 0x0000, 0x0000, 0x0000, 0x0165},
            //           ù       ú       û       ũ       ū       ŭ               ü               ů                       ű       ų       ŭ
            {0x0000, 0x00F9, 0x00FA, 0x00FB, 0x0169, 0x016B, 0x016D, 0x0000, 0x00FC, 0x0000, 0x016F, 0x0000, 0x0000, 0x0171, 0x0173, 0x016D},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                           ŵ
            {0x0000, 0x0000, 0x0000, 0x0175, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //
            {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   ý       ŷ                                       ÿ
            {0x0000, 0x0000, 0x00FD, 0x0177, 0x0000, 0x0000, 0x0000, 0x0000, 0x00FF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
            //                   ź                                       ż                                                               ž
            {0x0000, 0x0000, 0x017A, 0x0000, 0x0000, 0x0000, 0x0000, 0x017C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x017E},
    };

    // see table 37 in ETS 300706
    private static char sG2Charset[] = {
            //
            0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
            //
            0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020, 0x0020,
            //         ¡       ¢       £       $       ¥       #       §       ¤       ´       "       «       <       ^       =       v
            0x0020, 0x00a1, 0x00a2, 0x00a3, 0x0024, 0x00a5, 0x0023, 0x00a7, 0x00a4, 0x00b4, 0x0022, 0x00ab, 0x003c, 0x005e, 0x003d, 0x0076,
            // °       ±       ²       ³       ×       µ       ¶       ·       ÷       ´       "       »       ¼       ½       ¾       ¿
            0x00b0, 0x00b1, 0x00b2, 0x00b3, 0x00d7, 0x00b5, 0x00b6, 0x00b7, 0x00f7, 0x00b4, 0x0022, 0x00bb, 0x00bc, 0x00bd, 0x00be, 0x00bf,
            //           `       ´       ˆ       ~       ˉ       ˘       ˙       ̈       .       ˚               _       "               ˘
            0x0020, 0x0060, 0x00b4, 0x02c6, 0x007e, 0x02c9, 0x02d8, 0x02d9, 0x0308, 0x002e, 0x02da, 0x0020, 0x005f, 0x0022, 0x0020, 0x02d8,
            // -       ¹       ®       ©       ™       *       €       ‰       α                               *       *       *       *
            0x002d, 0x00b9, 0x00ae, 0x00a9, 0x2122, 0x002a, 0x20ac, 0x2030, 0x03b1, 0x0020, 0x0020, 0x0020, 0x002a, 0x002a, 0x002a, 0x002a,
            // Ω       Æ       Đ       a       Ħ               Ĳ       Ŀ       Ł       Ø       Œ       o       Þ       Ŧ       Ŋ       ŉ
            0x03a9, 0x00c6, 0x0110, 0x0061, 0x0126, 0x0020, 0x0132, 0x013f, 0x0141, 0x00d8, 0x0152, 0x006f, 0x00de, 0x0166, 0x014a, 0x0149,
            // ĸ       æ       đ       ď       ħ       ı       ĳ       ŀ       ł       ø       œ       ß       þ       ŧ       ŋ
            0x0138, 0x00e6, 0x0111, 0x010f, 0x0127, 0x0131, 0x0133, 0x0140, 0x0142, 0x00f8, 0x0153, 0x00df, 0x00fe, 0x0167, 0x014b, 0x0020
    };


    private char[] mG0Subset;
    private int mFontId;
    private int mMosaicRangeStart;
    private int mMosaicRangeEnd;


    FttxGXCharset(int fontId) {
        mFontId = fontId;
        mG0Subset = sG0Charsets[0];

        if (fontId == R.font.modeseven || fontId == R.font.modeseven_w3) {
            // U+E200 and U+E2F7
            mMosaicRangeStart = 0xE200;
            mMosaicRangeEnd = 0xE2F7;
        } else if (fontId == R.font.bedstead) {
            // U+EE00 and U+EE7F
            mMosaicRangeStart = 0xEE00;
            mMosaicRangeEnd = 0xEE7F;
        }
    }
    void setG0Charset(int code) {
        if (code >= 0 && code < sG0Charsets.length)
            mG0Subset = sG0Charsets[code];
    }

    char getG2Char(int code) {
        if (code >= 0 && code < sG2Charset.length)
            return sG2Charset[code];
        else
            return (char) code;
    }

    char getG0Char(int code, char[] subset) {
        if (subset == null)
            return (char) code;

        char character;
        switch (code) {
            /* special national characters */
            case 0x23:
                character = subset[0];
                break;
            case 0x24:
                character = subset[1];
                break;
            case 0x40:
                character = subset[2];
                break;
            case 0x5b:
                character = subset[3];
                break;
            case 0x5c:
                character = subset[4];
                break;
            case 0x5d:
                character = subset[5];
                break;
            case 0x5e:
                character = subset[6];
                break;
            case 0x5f:
                character = subset[7];
                break;
            case 0x60:
                character = subset[8];
                break;
            case 0x7b:
                character = subset[9];
                break;
            case 0x7c:
                character = subset[10];
                break;
            case 0x7d:
                character = subset[11];
                break;
            case 0x7e:
                character = subset[12];
                break;
            case 0x0d:
                character = (char) code;
                break;
            default:
                character = (char) code;
                break;
        }

        return character;
    }

    char getG0LatinChar(int code) {
        return getG0Char(code, sG0Charsets[0]);
    }

    char getG0Char(int code) {
        return getG0Char(code, mG0Subset);
    }

    char getG0DiacriticalChar(int code, int mode) {
        char value = 0;

        if ((code >= 0x41) && (code <= 0x5A)) {
            value = sDiacriticalUppercaseMap[code - 0x41][mode];
        } else if ((code >= 0x61) && (code <= 0x7A)) {
            value = sDiacriticalLowerCaseMap[code - 0x61][mode];
        }

        if (value == 0)
            value = (char) code;

        return value;
    }

    public char getG1Char(int code) {
        if (mFontId == R.font.modeseven || mFontId == R.font.modeseven_w3) {
            if ((code > 0x20) && (code <= 0x3f)) {
                return (char) ((mMosaicRangeStart + code) - 0x20);
            } else if ((code >= 0x60) && (code <= 0x7f)) {
                return  (char) ((mMosaicRangeStart + code) - 0x40);
            } else {
                return getG0Char(code);
            }
        }
        else if (mFontId == R.font.bedstead)
        {
            if (((code >= 0x20) && (code <= 0x3f))
                    || ((code >= 0x60) && (code <= 0x7f))) {
                return (char) ((mMosaicRangeStart + code) - 0x20);
            } else {
                return getG0Char(code);
            }
        }
        else
        {
            return 0x20;
        }

    }
}
